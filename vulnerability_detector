#!/usr/bin/python3
import argparse
from argparse import RawTextHelpFormatter
import pattern
import analyze
#from ast import *

def main():

    description = 'Vulnerability Detector\n'

    usage = '\n\
    vulnerability_detector <sliceJSON> <patternsJSON>\n'

    parser = argparse.ArgumentParser(prog='vulnerability_detector', description=description,
                                     usage=usage, formatter_class=RawTextHelpFormatter)
    parser.add_argument('sliceJSON', type=str)
    parser.add_argument('patternsJSON', type=str)

    args = parser.parse_args()

    print(args.sliceJSON)
    print(args.patternsJSON)

    with open(args.patternsJSON, "r") as json_pattern_file:
        pattern_list = pattern.parse(json_pattern_file)

    with open(args.sliceJSON, "r") as json_slice_file:
        json_output = analyze.find_vulnerability(json_slice_file,pattern_list)
    print(json_output)

if __name__ == "__main__":
    main()